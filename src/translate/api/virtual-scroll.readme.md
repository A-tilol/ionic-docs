# ion-virtual-scroll

Virtual Scrollは、Virtualの "infinite" リストを表示します。
レコードの配列が、テンプレートを作成するデータを含むVirtual Scrollに渡されます。
各レコードに対して作成されるセルと呼ばれるテンプレートは、
アイテム、ヘッダー、およびフッターで構成できます。
パフォーマンス上の理由から、リスト内のすべてのレコードが一度にレンダリングされるわけではありません。
その代わりに、レコードの小さなサブセット(ビューポートをいっぱいにするのに十分な数)がレンダリングされ、ユーザーのスクロールに再利用されます。


## Approximate Widths and Heights

仮想スクロールのアイテムの高さがデフォルトサイズの `40px` に近くない場合は、
`approxItemHeight` プロパティの値を指定することが非常に重要です。
ピクセル単位の正確なサイズは必要ありませんが、見積もりなしでは仮想スクロールは正しくレンダリングされません。

各テンプレートのおおよその幅と高さを使用して、
作成するセルの数を決定したり、
スクロール可能領域の高さを計算したりします。
各セルの実際の描画サイズはアプリケーションのCSSから得られるのに対し、
この近似値は初期次元の計算にのみ使用されることに注意してください。

また、Ionicのデフォルトのアイテムのサイズは、
プラットフォームによって高さが若干異なりますが、これは問題ありません。

## Images Within Virtual Scroll

HTTPリクエスト、イメージのデコード、およびイメージのレンダリングによって、
スクロール中にjankが発生することがあります。
Ionicはイメージをより良く制御するために、
HTTPリクエストとイメージレンダリングを管理する `<ion-img>` を提供している。
アイテムをすばやくスクロールすると、`<ion-img>` はいつ要求を行わないか、
いつ画像をレンダリングしないかを認識し、スクロール後に表示可能な画像のみをロードします。
詳細については、 [Read more about `ion-img`.](../img) を参照してください。

また、アプリ開発者にとって重要なのは、画像サイズがロックされていることを確認することであり、
画像が完全にロードされた後、サイズが変更されたり、
他の要素サイズに影響を与えたりすることはないことに注意ください。
簡単に言えば、レンダリングバグが発生しないようにするには、
仮想アイテム内の要素が動的に変化しないことが重要です。

Virtual Scrollでは、`<img>` のNatural Effectsは望ましくありません。
DOMに要素を追加すると、`<img>` 要素は直ち画像ファイルに対するHTTP要求を作成するため、
ネイティブの `<img>` 要素よりも `<ion-img>` コンポーネントを使用することをお薦めします。
さらに、`<img>`は、ユーザーがスクロールしている間であれば常にレンダリングされてしまいます。
`<ion-img>` は、含有する `ion-content` によって制御され、
高速にスクロールしてもイメージをレンダリングしません。


## Virtual Scroll Performance Tips

### iOS Cordova WKWebView

Cordovaを使ってiOSにデプロイする場合は、
[WKWebView plugin](https://blog.ionicframework.com/cordova-ios-performance-improvements-drop-in-speed-with-wkwebview/)
プラグインを使ってiOSの高性能なウェブビューを利用することを強くお勧めします。
さらに、WKWebViewは、以前のUIWebViewよりも
スクロールの効率が優れています。

### 要素のサイズと位置を固定する

仮想スクロールですべてのアイテムのサイズと位置を効率的に変更するには、
各仮想アイテム内のすべての要素がそのサイズや位置を
動的に変更しないことが非常に重要です。
サイズと位置が変わらないようにする最善の方法は、
各仮想アイテムがCSSを使ってそのサイズにロックされていることです。

### 画像に `ion-img` を使う

仮想スクロールにイメージを含める場合は、標準の<img>HTML要素ではなく、
必ず[`ion-img`](../img/Img/)要素を使用してください。
`ion-img`では、画像は遅延ロードされるため、表示可能な画像のみがレンダリングされ、
HTTPリクエストはスクロール中に効率的に制御されます。

### 概算の幅と高さを設定する

前述のように、すべての要素の寸法がロックされます。
ただし、virtual scrollは、レンダリングされるまで寸法を認識しません。
最初のレンダリングでは、
virtual scrollで構築する項目数を設定する必要があります。
`approxItemHeight` などの"approx"プロパティを使用すると、
virtual scrollにおおよそのサイズを指定できるため、
virtual scrollで作成する項目数を決定できます。

### データセットの変更にはtrackByを使用する

データは変更されていなくても、イテレータ内の要素のIDは変更されます。
たとえば、RPCからサーバーに対してイテレーターが生成され、
そのRPCが再実行された場合などです。
「データ」が変更されていなくても、2回目の応答では異なるIDを持つオブジェクトが生成され、
IonicはDOM全体を分解して再構築します。
これはハイコストな操作であり、可能であれば回避する必要があります。

### 効率的なヘッダーおよびフッター機能
各仮想アイテムは非常に効率的でなければなりませんが、実際にそのパフォーマンスを低下させる1つの方法は、
セクション・ヘッダーおよびフッター関数内でDOM操作を実行することです。
これらの関数はデータセット内のすべてのレコードに対して呼び出されるため、
パフォーマンスコストが高いことを確認してください。

## React

The Virtual Scroll component is not supported in React.

## Vue

`ion-virtual-scroll` is not supported in Vue. We plan on integrating with existing community-driven solutions for virtual scroll in the near future. Follow our [GitHub issue thread](https://github.com/ionic-team/ionic-framework/issues/17887) for the latest updates.

